'use strict';var intentlyContent=function(){if(!1===document instanceof HTMLDocument)return!1;if(vAPI&&!vAPI.contentscriptIntentlyInjected){vAPI.contentscriptIntentlyInjected=!0;window.location.host=="www"+Conf.DOMAIN&&document.body.setAttribute(vAPI.strings.extensionInstallationAttribute,"1");var g=null,m=!0,p=[],e={},f,u=vAPI.messaging.channel("intently-content.js");vAPI.messager=u;var v=1,h={postMessage:function(a){a.what="intently";var b=window.location.href;a.pageURL=b;a.locationURL=b;u.send(a,
h.onMessage)}};vAPI.changeVisibility=function(a){var b="hidden";a&&(b="visible");try{if(document.querySelector("header"))for(document.querySelector("header").style.visibility=b,k=0;k<document.querySelectorAll("header .intentlyImpressionOverlay").length;k++)document.querySelectorAll("header .intentlyImpressionOverlay")[k].style.visibility=b,document.querySelectorAll("header .intentlyImpressionOverlay")[k].parentElement.querySelector("img").style.visibility=b;if(document.querySelector("nav"))for(document.querySelector("nav").style.visibility=
b,k=0;k<document.querySelectorAll("nav .intentlyImpressionOverlay").length;k++)document.querySelectorAll("nav .intentlyImpressionOverlay")[k].style.visibility=b,document.querySelectorAll("nav .intentlyImpressionOverlay")[k].parentElement.querySelector("img").style.visibility=b}catch(c){}};vAPI.resizeFrameElem=function(a){var b=a.contentDocument,c=600,d=340;b.getElementById&&(c=b.body.scrollHeight,d=b.body.scrollWidth);c<screen.height&&(c=screen.height);360>d&&(d=360);a.height=c+"px";a.width=d+"px";
a.style.height=c+"px";a.style.width=d+"px"};vAPI.insertIntentlyiframe=function(a){vAPI.changeVisibility(!1);var b=document.createElement("div");b.setAttribute("class","intentlymodalDialog");b.setAttribute("style","position: fixed; font-family: Arial, Helvetica, sans-serif; top: 0; right: 0; bottom: 0; left: 0; background: rgba(0, 0, 0, .8); z-index: 99999;");var c=document.createElement("div");c.setAttribute("style","width: 350px; position: relative; margin: 0 auto; padding: 5px 20px 13px; border-radius: 10px;");
var d=document.createElement("iframe");d.setAttribute("width","350");d.setAttribute("height","600");d.setAttribute("style","border: 0px none;");d.setAttribute("srcdoc",a);c.appendChild(d);d.onload=function(){vAPI.resizeFrameElem(d);d.contentDocument.addEventListener("receive-intently",function(a){a=a.detail;if("useraction"==a.messageType){h.postMessage(a);var b=document.querySelector(".intentlymodalDialog");b.parentNode.removeChild(b);vAPI.changeVisibility(!0)}"closesharedialog"==a.messageType&&(b=
document.querySelector(".intentlymodalDialog"),b.parentNode.removeChild(b),vAPI.changeVisibility(!0));"resize"==a.messageType&&vAPI.resizeFrameElem(d)},!0)};b.appendChild(c);document.body.insertBefore(b,document.body.firstChild)};vAPI.insertIntentlyCss=function(a,b){var c=document.createElement("style");c.type="text/css";(document.head||document.documentElement).insertBefore(c,null);if(c.sheet){c.sheet.insertRule(vAPI.strings.intentlyAdAnimationRule,0);c.sheet.insertRule(vAPI.strings.intentlyNestedParentAdAnimationRule,
0);c.sheet.insertRule(vAPI.strings.intentlyNestedChildAdAnimationRule,0);Utils.log("animation styles defined");for(var d=0;d<b.identifiers.length;d+=1E3){for(var l=b.identifiers.slice(d,d+1E3),e=[],f=0;f<l.length;f++)e.push(l[f]);l=e.join(",")+vAPI.strings.intentlyAdidentifiedRule;c.sheet.insertRule(l,0)}if(b.nestedIdentifiers.length){l=[];for(d=0;d<b.nestedIdentifiers.length;d++)l.push(b.nestedIdentifiers[d].parentRule);d=l.join(",")+vAPI.strings.intentlyNestedParentAdIdentifiedRule;c.sheet.insertRule(d,
0)}Utils.log("ad definition identifiers defined as styles");c.sheet.insertRule(vAPI.strings.impressionOverlayRule,0);c.sheet.insertRule(".intentlyImpressionOverlay:hover { opacity: 1; }",0);c.sheet.insertRule(".intentlyImpressionButton { cursor: pointer; }",0);c.sheet.insertRule(".intentlyShareButton { cursor: pointer; }",0);c.sheet.insertRule(".intentlyFacebookShareButton { cursor: pointer; }",0);c.sheet.insertRule(".layout-square-thumbsup { position: absolute; left: 10px; top: 10px; width: 26px;height: 26px; display:inline-block; background-position: center;  background-repeat: no-repeat;  background-size:16px;  vertical-align: middle;  border-radius: 1px;  border: solid 1px #4d4d4d;     background-color: #28c157;}",
0);c.sheet.insertRule(".layout-square-share { position: absolute; left: 46px; top: 10px; width: 26px; height: 26px; display:inline-block; background-position: center;  background-repeat: no-repeat;  background-size:16px;  vertical-align: middle;  border-radius: 1px;  border: solid 1px #4d4d4d;     background-color: white;}",0);c.sheet.insertRule(".layout-square-thumbsdown { position: absolute; left: 10px; top: 46px; width: 26px; height: 26px; display:inline-block; background-position: center;  background-repeat: no-repeat;  background-size:16px;  vertical-align: middle;  border-radius: 1px;  border: solid 1px #4d4d4d;     background-color: #28c157; }",
0);c.sheet.insertRule(".layout-square-fb { position: absolute; left: 46px; top: 46px; width: 26px; height: 26px;  display:inline-block; background-position: center;  background-repeat: no-repeat;  background-size:16px;  vertical-align: middle;  border-radius: 1px;  border: solid 1px #4d4d4d;     background-color: white;}",0);c.sheet.insertRule(".intently-horizontal-thumbsup-bg { background-color: #28c157; border-radius: 2px;  border: solid 1px #4d4d4d; }",0);c.sheet.insertRule(".ext-txt { color: #4d4d4d;  font-weight: 300;  font-size: 16px;  margin-left: 20px;  display: inline; }",
0);c.sheet.insertRule(".layout-horizontal-thumbsup { position: absolute; left: 10px; top: 10px; display:inline-block;  width: 40px;  height: 40px;  background-position: center;  background-repeat: no-repeat;  background-size:24px;  vertical-align: middle;  border-radius: 2px;  border: solid 1px #4d4d4d; border-right:none;     background-color: #28c157; }",0);c.sheet.insertRule(".layout-horizontal-thumbsup-text { position: absolute; left: 50px; top: 10px; display:inline-block; color: #ffffee;  font-weight: 300;  font-size: 14px; width: 190px;  height: 40px;  vertical-align: middle; text-align:left;   line-height:40px;  border-radius: 2px;  border: solid 1px #4d4d4d; border-left:none; background-color: #28c157; }",
0);c.sheet.insertRule(".layout-horizontal-thumbsdown { position: absolute; left: 10px; top: 60px; display:inline-block;  width: 40px;  height: 40px;  background-position: center;  background-repeat: no-repeat;  background-size:24px;  vertical-align: middle;  border-radius: 2px;  border: solid 1px #4d4d4d;     background-color: #28c157;}",0);c.sheet.insertRule(".layout-horizontal-share { position: absolute; left: 10px; top: 110px; display:inline-block;  width: 40px;  height: 40px;  background-position: center;  background-repeat: no-repeat;  background-size:24px;  vertical-align: middle;  border-radius: 2px;  border: solid 1px #4d4d4d;     background-color: white;}",
0);c.sheet.insertRule(".layout-horizontal-fb { position: absolute; left: 10px; top: 160px; display:inline-block;  width: 40px;  height: 40px;  background-position: center;  background-repeat: no-repeat;  background-size:24px;  vertical-align: middle;  border-radius: 2px;  border: solid 1px #4d4d4d;     background-color: white; }",0);a.showIntendButton&&(c.sheet.insertRule(vAPI.strings.imageAnimationRule,0),c.sheet.insertRule(vAPI.strings.imageIdentifierRule,0),c.sheet.insertRule(".intentlyIntendButton { height: 24px; width: 24px; position: absolute; z-index: 999999999; display: none; cursor: pointer; opacity: 0.9; background-image: url(data:image/png;base64,"+
Conf.INTEND_BUTTON_BASE64+"); } ",0),c.sheet.insertRule(".intentlyIntendButton:hover { opacity: 1; }",0));Utils.log("impression and sharing styles defined")}else window.setTimeout(function(){vAPI.insertIntentlyCss(a,b)},0)};h.onMessage=function(a){var b={};Utils.log(a);if(a&&a.messageType){if("config"==a.messageType){for(var c in a.config)Conf[c]=a.config[c];m=a.intentlyActive;g=a.adDefinitions;Utils.log("config and ad definitions received:");if(0===g.identifiers.length)return;-1==window.location.href.indexOf("intently.com")&&
vAPI.insertIntentlyCss(a,g)}else if("instruction"==a.messageType)if("replaceads"==a.instruction){var d=[];Utils.log("replacing ads: message received");a.adReplacements&&0<a.adReplacements.length&&(Utils.log("replacing ads:"),Utils.log(a.adReplacements),a.adReplacements.forEach(function(a){var b=document.querySelector('[intentlyAdID="'+a.intentlyID+'"]');if(b)if(b.style.display="none",a.channelResourceID){var c=a.replacementHTML.replace("???",a.replacementResourceData);b.outerHTML+=c;a.url=window.location.href;
(b=a.url.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i))&&1<b.length&&(a.domain=b[1].replace("www.",""));a.timestamp=(new Date).getTime();d.push(a)}else a.hide&&Utils.log("hiding ad",a);else Utils.log("could not find ad with intentlyID "+a.intentlyID)}));m&&(b.messageType="response",b.response="adsreplaced",b.replacedAds=d);Conf.DEBUG&&b.replacedAds&&0<b.replacedAds.length&&Utils.log("sending response with "+b.replacedAds.length+" replaced ads to runtime")}else if("identifylastrightclickad"==a.instruction){Utils.log("getting last right click info");
b.messageType="response";b.response="lastrightclickadidentified";if(e.lastRightClickTarget){a=!1;for(c=0;c<e.lastRightClickTarget.attributes.length;c++)if("intentlyreplacementid"==e.lastRightClickTarget.attributes[c].name.toLowerCase()||"intentlyreplacementparentid"==e.lastRightClickTarget.attributes[c].name.toLowerCase())a=!0;a?(b.messageType="usernotification",b.title="Ad Not Reported",b.message="That image is part of Intently!"):(a={},a.domain=window.location.hostname.replace("www.",""),a.url=
window.location.href,a.outerHTML=e.lastRightClickTarget.outerHTML,c=w(e.lastRightClickTarget),a.proposedSelector=c.uniqueSelector,a.proposedSelectorOuterHTML=c.uniqueSelectorOuterHTML,a.proposedSelectorParentLevel=c.uniqueSelectorParentLevel,b.lastRightClickAd=a)}else b.messageType="contentscripterror",b.error="ReportAdNotIdentified",b.details="Last right click target is null. Page URL: "+window.location.href;e.lastRightClickTarget=null}else if("identifylastrightclickintention"==a.instruction){Utils.log("getting last right click info:");
Utils.log(e.lastRightClickTarget);if(e.lastRightClickTarget){a=!1;for(c=0;c<e.lastRightClickTarget.attributes.length;c++)if("intentlyreplacementid"==e.lastRightClickTarget.attributes[c].name.toLowerCase()||"intentlyreplacementparentid"==e.lastRightClickTarget.attributes[c].name.toLowerCase())a=!0;a?(b.messageType="usernotification",b.title="Image Not Added",b.message="The image is already part of Intently!"):(b.messageType="response",b.response="lastrightclickintentionidentified",b.lastRightClickIntentionPageURL=
window.location.href,b.lastRightClickIntentionURL=e.lastRightClickTarget.src,b.lastRightClickIntentionDescription=e.lastRightClickTarget.title||e.lastRightClickTarget.alt||window.top.document.title)}else b.messageType="contentscripterror",b.error="IntentionNotIdentified",b.details="Last right click target is null. Page URL: "+window.location.href;e.lastRightClickTarget=null}else"opensharemodal"==a.instruction&&vAPI.insertIntentlyiframe(a.framedoc);0<Object.keys(b).length&&h.postMessage(b)}else Utils.log("empty",
a)};window==window.top&&(Utils.log("retrieving config and definitions"),h.postMessage({messageType:"loadconfig"}));var q=function(){f.style.display="none";f.description=null},x=function(a){Utils.log("impression button clicked:");var b={channelResourceID:a.target.attributes.channelResourceID.value,impression:a.target.attributes.impressionValue.value};Utils.log(b);h.postMessage({messageType:"useraction",action:"impressionbuttonclicked",impressionButtonClickData:b});a.target.className=a.target.className.replace(a.target.getAttribute("activeClass"),
"");a.target.className=a.target.className+" "+a.target.getAttribute("inactiveClass");a.target.style.backgroundImage="url('"+a.target.getAttribute("inactiveSrc")+"')";if(b=document.getElementById("thumbs"+("1"===a.target.attributes.impressionValue.value?"Down":"Up")+"ImpressionButton-"+a.target.attributes.intentlyReplacementParentID.value))b.className=b.className.replace(b.getAttribute("inactiveClass"),""),b.className=b.className+" "+b.getAttribute("activeClass"),b.style.backgroundImage="url('"+b.getAttribute("activeSrc")+
"')";"0"===a.target.attributes.impressionValue.value&&(a=document.querySelector('div[intentlyReplacementID="'+a.target.attributes.intentlyReplacementParentID.value+'"]'))&&(a.style.display="none")};f=document.createElement("span");f.classList.add("intentlyIntendButton");f.setAttribute("title","Add this image to Intently");f.imageURL=null;f.description=null;f.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();h.postMessage({messageType:"useraction",action:"intendbuttonclicked",
intendButtonClickData:{imageURL:f.imageURL,pageURL:window.top.location.href,description:f.description}});q()});document.body?document.body.appendChild(f):Utils.log("Unable to attach Add image to intently");e.lastRightClickTarget=null;document.querySelector("html").addEventListener("mousedown",function(a){if(m)if(2==a.button)e.lastRightClickTarget=a.target;else if(0===a.button)if(0<=a.target.className.indexOf("intentlyImpressionButton")&&a.target.attributes.impressionValue&&a.target.attributes.channelResourceID)a.preventDefault(),
a.stopPropagation(),x(a);else if(null!=document.querySelector("#"+a.target.getAttribute("data-target-id"))){a.preventDefault();a.stopPropagation();var b={};b.target=document.querySelector("#"+a.target.getAttribute("data-target-id"));x(b)}else 0<=a.target.className.indexOf("intentlyShareButton")&&a.target.attributes.channelResourceID?(a.preventDefault(),a.stopPropagation(),h.postMessage({messageType:"useraction",action:"sharebuttonclicked",shareButtonClickData:{channelResourceID:a.target.attributes.channelResourceID.value,
imgURL:a.target.attributes["data-imgURL"].value}})):0<=a.target.className.indexOf("intentlyImpressionOverlay")&&a.target.attributes.destination?(a.preventDefault(),a.stopPropagation(),window.open(a.target.attributes.destination.value,"_blank")):0<=a.target.className.indexOf("intentlyFacebookShareButton")&&a.target.attributes.channelResourceID&&(a.preventDefault(),a.stopPropagation(),h.postMessage({messageType:"useraction",action:"facebooksharebuttonclicked",facebookShareButtonClickData:{channelResourceID:a.target.attributes.channelResourceID.value}}))});
var w=function(a,b){b="undefined"!==typeof b?b:0;var c=a.localName;if(a.id)c+="#"+a.id;else if(0<a.classList.length){for(var d=[],l=0;l<a.classList.length;l++)d.push(a.classList[l]);c+="."+d.join(".")}d=document.querySelectorAll(c);if(1===d.length)return{uniqueSelector:c,uniqueSelectorOuterHTML:d[0].outerHTML,uniqueSelectorParentLevel:b};if(null===a.parentElement||b==Conf.MAXIMUM_AD_IDENTIFICATION_PARENT_LEVEL)return{uniqueSelector:null,uniqueSelectorOuterHTML:null,uniqueSelectorParentLevel:b};b++;
return w(a.parentElement,b)},n=null,y=function(){n=null;var a={messageType:"identifiedads",identifiedAds:p};Utils.log("sending "+a.identifiedAds.length+" identified ads to runtime");h.postMessage(a);p=[]},r=function(a){a.style.visibility="hidden";if(a.getAttribute("intentlyAdHideExceptionID"))Utils.log("re-hiding an exception:"),Utils.log(a),a.style.display="none";else if(a.getAttribute("intentlyAdID")&&document.querySelector('[intentlyReplacementID="'+a.getAttribute("intentlyAdID")+'"]'))Utils.log("re-hiding an already replaced ad:"),
Utils.log(a),a.style.display="none";else{var b=a.getBoundingClientRect();if(b.height>Conf.MINIMUM_AD_REPLACEMENT_HEIGHT&&b.width>Conf.MINIMUM_AD_REPLACEMENT_WIDTH){var c=a.parentNode;try{for(;c&&c!==document&&null!=c&&void 0!=c;){if(c.matches("[intentlyAdID]")){Utils.log("ad identifier ignored due to parent identification:");Utils.log(parent);return}c=c.parentNode}}catch(l){Utils.log("ignored "+l)}a.setAttribute("intentlyAdID",v);v++;if(g&&g.exceptions)for(c=0;c<g.exceptions.length;c++){var d=document.querySelector(g.exceptions[c]+
'[intentlyAdID="'+a.getAttribute("intentlyAdID")+'"]');if(d){a.setAttribute("intentlyAdIgnoreExceptionID",a.getAttribute("intentlyAdID"));a.removeAttribute("intentlyAdID");a.style.visibility="visible";Utils.log("ad identifier ignore exception encountered:");Utils.log(d);return}}if(g&&g.hideOverrides)for(c=0;c<g.hideOverrides.length;c++)if(d=document.querySelector(g.hideOverrides[c]+'[intentlyAdID="'+a.getAttribute("intentlyAdID")+'"]')){a.setAttribute("intentlyAdHideExceptionID",a.getAttribute("intentlyAdID"));
a.removeAttribute("intentlyAdID");Utils.log("ad identifier hide exception encountered:");Utils.log(d);a.style.display="none";return}if(b.height*b.width/(window.innerHeight*window.innerWidth)>=Conf.MAXIMUM_AD_REPLACEMENT_SCREEN_PIXEL_RATIO)a.setAttribute("intentlyAdHideExceptionID",a.getAttribute("intentlyAdID")),a.removeAttribute("intentlyAdID"),Utils.log("very large ad hide exception encountered:"),Utils.log(a),a.style.display="none";else{d={};d.intentlyID=a.getAttribute("intentlyAdID");d.height=
b.height;d.width=b.width;d.adHTML=a.outerHTML;b="";for(c=0;c<Conf.REPLACEMENT_STYLE_NAMES.length;c++)b+=Conf.REPLACEMENT_STYLE_NAMES[c]+": "+getComputedStyle(a)[Conf.REPLACEMENT_STYLE_NAMES[c]]+"; ";d.replacementStyles=b;p.push(d);n&&clearTimeout(n);n=setTimeout(y,Conf.IDENTIFIED_ADS_BUFFER_COOLDOWN)}}else null==a.getAttribute("intentlyPause")||5>parseInt(a.getAttribute("intentlyPause"))?(Utils.log("ad not large enough for replacement ("+b.width+"x"+b.height+"), pausing:"),Utils.log(a),b=parseInt(a.getAttribute("intentlyPause")||
"0")+1,a.setAttribute("intentlyPause",b),setTimeout(function(){r(a)},1E3)):a.style.display="none"}},z=function(a,b){try{b||(b=document);var c=/:innerHTML\(['"](.*?)["']\)/.exec(a);if(c){for(var d=a.replace(/:innerHTML\(['"](.*?)["']\)/,""),l=c[1],e=b.querySelectorAll(d),c=0;c<e.length;c++)if(e[c].innerHTML.trim()==l.trim())return e[c];return null}return b.querySelector(a)}catch(f){return null}};document.addEventListener(vAPI.strings.animationStart,function(a){if("intentlyAdIdentified"==a.animationName)r(a.target);
else if("intentlyNestedParentAdIdentified"==a.animationName){a=a.target;a.matches=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;for(var b=0;b<g.nestedIdentifiers.length;b++)a.matches(g.nestedIdentifiers[b].parentRule)&&z(g.nestedIdentifiers[b].childRule,a)&&(Utils.log("found parent with child",a),r(a))}else"intentlyImageIdentifier"==a.animationName&&(a=a.target,"IMG"!=a.tagName&&""===a.style.backgroundImage||a.attributes.intentlyreplacementparentid||
(b=a.getBoundingClientRect(),3E4<b.height*b.width&&(a.addEventListener("mouseover",function(a){if(0!==a.target.src.indexOf("data:image")&&(a=a.target,m)){a.getBoundingClientRect();var b;var e=a,g=b=0,h=e.getBoundingClientRect();if(e.offsetParent){do b+=e.scrollLeft,g+=e.scrollTop;while(e=e.offsetParent);b={left:h.left+b,top:h.top+g}}else b=void 0;e=b.left+10;b=b.top+10;f.imageURL=a.src;f.description=a.title||a.alt||window.top.document.title;f.style.left=e+"px";f.style.top=b+"px";f.style.display="block"}}),
a.addEventListener("click",function(a){q()}),a.addEventListener("mouseout",function(a){(a.relatedTarget||a.toElement)!=f&&q()}))))},!1);window.onIntentionClick=function(a,b){Utils.log(a);Utils.log(b)};if(window.location.host=="www"+Conf.DOMAIN){var t=document.createElement("div");t.setAttribute("id","ad_space");t.setAttribute("style","top: -1px !important; left: -1px !important; height: 1px; width: 1px;");document.body.appendChild(t);0==document.getElementById("ad_space").getBoundingClientRect().height+
document.getElementById("ad_space").getBoundingClientRect().width&&h.postMessage({messageType:"adblockerdetected"})}return{backgroundPort:h}}}();
