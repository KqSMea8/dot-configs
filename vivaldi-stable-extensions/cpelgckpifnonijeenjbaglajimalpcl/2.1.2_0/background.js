var tab=chrome.extension.getURL("new-tab.html");var blockedUrls;var listItems;var thisurl;var pause;chrome.storage.sync.get({blockedUrls:[],listItems:[],pause:{active:!1,pauseMoment:"",dayOff:"",duration:0}},function(data){blockedUrls=data.blockedUrls;listItems=data.listItems;pause=data.pause});function resetPause(){var pauseObj={active:!1,pauseMoment:0,dayOff:"",duration:0}
chrome.storage.sync.set({pause:pauseObj,},function(){console.log(pause.pauseMoment)})}
function updatePause(){if(pause.active===!0){console.log("pause active is true");var now=moment();var pauseMoment=moment.unix(pause.pauseMoment);if(pause.duration>0){console.log("pause duration is more than 0 "+pause.duration);console.log(now);console.log(pauseMoment.toString());pauseMoment.add(pause.duration,'minutes');console.log(pauseMoment.toString());if(now.isAfter(pauseMoment)){console.log("time has passed");resetPause()}}else if(pause.dayOff==="true"){console.log("day off is true");pauseMoment.endOf("day").add(4,'hours');console.log(pauseMoment.toString());if(now.isAfter(pauseMoment)){console.log("time has passed");resetPause()}}}}
function checkBlock(details){updatePause();if(pause.active===!0){console.log("paused");return{cancel:!1}}else{console.log("not paused");thisurl=details.url;var urlPattern=/^(?:https?:\/\/)?(?:w{3}\.)?([a-z\d\.-]+)\.(?:[a-z\.]{2,10})(?:[/\w\.-]*)*/;var domainPattern=thisurl.match(urlPattern);if(domainPattern==null){return{cancel:!1}}else{if(domainPattern[1].indexOf('.')>-1){var getStrAfterDot=domainPattern[1].split(".");var extractDomain=getStrAfterDot[1];var extractDomain2=getStrAfterDot[0]}else{var extractDomain=domainPattern[1];var extractDomain2='!'}}
if((blockedUrls.some(function(v){return extractDomain===v})||blockedUrls.some(function(v){return extractDomain2===v}))&&listItems!==""){if((thisurl.match(/\./g)||[]).length==1){var blockedurl=thisurl.split("/")[2]}else{var blockedurl=thisurl.split(".")[1]+"."+thisurl.split(".")[2].split("/")[0]}
chrome.storage.sync.set({'blockedurl':blockedurl},function(){});return{redirectUrl:tab}}else{var specificURL=details.url.replace(/(^\w+:|^)\/\//,'').split("?")[0];for(var il=0;il<blockedUrls.length;il++){if(specificURL.startsWith(blockedUrls[il])&&listItems!==""){var blockedurl=specificURL.replace(/\/$/,"");chrome.storage.sync.set({'blockedurl':blockedurl},function(){});return{redirectUrl:tab}}else if(il===blockedUrls.length){return{cancel:!1}}}}}}
chrome.webRequest.onBeforeRequest.addListener(checkBlock,{urls:["<all_urls>"],types:["main_frame"]},["blocking"]);chrome.storage.onChanged.addListener(function(changes,area){if(area=="sync"&&"listItems" in changes){listItems=changes.listItems.newValue}});chrome.storage.onChanged.addListener(function(changes,area){if(area=="sync"&&"blockedUrls" in changes){blockedUrls=changes.blockedUrls.newValue}});chrome.storage.onChanged.addListener(function(changes,area){if(area=="sync"&&"pause" in changes){pause=changes.pause.newValue}})
