'use strict';(function(){function k(a){e.send({what:"gotoURL",details:{url:a,select:!0,index:-1}});setTimeout(function(){vAPI.closePopup()},50)}var a;uDom();var f="";vAPI.i18n("popupBlockedStats");vAPI.i18n("popupHitDomainCount");var e=vAPI.messaging.channel("popup.js"),l=function(){a.tabTitle&&(document.title=a.appName+" - "+a.tabTitle);uDom(".btnLogin").attr("data-href",a.loginUrl);uDom(".btnInit").attr("data-href",a.initializationHelpUrl);uDom("#stats-active").css("display","none");uDom("#stats-off").css("display",
"none");uDom("#stats-init").css("display","none");uDom("#stats-disabled").css("display","none");uDom("#stats-"+a.extStatus).css("display","");"active"!==a.extStatus?(uDom("#overlaycontainer").css("display",""),uDom(".loggedin").css("display","none")):(uDom("#overlaycontainer").css("display","none"),uDom(".loggedin").css("display",""),updateNotificationCount(a.notificationCount),updateAdReplacementCount(a.pageReplacedAdCount),uDom(".btnShare").attr("data-href",a.tellAFriendUrl),uDom(".btnSettings").attr("data-href",
a.settingsUrl),uDom(".btnNotification").attr("data-href",a.notificationUrl),uDom(".btnDashboard").attr("data-href",a.dashboardUrl),uDom(".ext-close").on("click",function(a){vAPI.closePopup()}),a.intentlyEnabled?(uDom("#stats-disabled").css("display","none"),uDom(".btnManageIntentlyEnabled div.ext-icon").removeClass("enable_all"),uDom(".btnManageIntentlyEnabled div.ext-icon").addClass("disable_all"),uDom(".btnManageIntentlyEnabled span.ext-txt-options").html(" Disable Intently Everywhere")):(uDom("#stats-disabled").css("display",
""),uDom(".btnManageIntentlyEnabled div.ext-icon").removeClass("disable_all"),uDom(".btnManageIntentlyEnabled div.ext-icon").addClass("enable_all"),uDom(".btnManageIntentlyEnabled span.ext-txt-options").html(" Enable Intently Everywhere")),a.whiteListed?(uDom(".btnManageSite div.ext-icon").removeClass("disable_site"),uDom(".btnManageSite div.ext-icon").addClass("enable_site"),uDom(".btnManageSite span.ext-txt-options").html(" Enable on this site")):(uDom(".btnManageSite div.ext-icon").removeClass("enable_site"),
uDom(".btnManageSite div.ext-icon").addClass("disable_site"),uDom(".btnManageSite span.ext-txt-options").html(" Disable on this site")))},m=function(c){a&&a.pageURL&&("behind-the-scene"!==a.pageHostname||a.advancedUserEnabled)&&(e.send({what:"toggleWhitelistChange",url:a.pageURL,scope:c.ctrlKey||c.metaKey?"page":"",state:!uDom("body").toggleClass("off").hasClass("off"),tabId:a.tabId}),vAPI.closePopup())},n=function(c){a&&(e.send({what:"toggleIntentlyEnabled",tabId:a.tabId}),vAPI.closePopup())},p=
function(){var c=null,b=function(){c=null;e.send({what:"hasPopupContentChanged",tabId:a.tabId,contentLastModified:a.contentLastModified},d)},d=function(b){b?g(a.tabId):h()},h=function(){null===c&&(c=setTimeout(b,5E3))};return h}(),g=function(c){e.send({what:"getPopupData",tabId:c},function(b){console.log("returning cached");a={};if("object"===typeof b&&(a=b,b=a.hostnameDict,"object"===typeof b)){var d,c;for(c in b)!1!==b.hasOwnProperty(c)&&(d=b[c].domain,d===a.pageDomain&&(d=" "),d=c.slice(0,0-d.length),
d.split(".").reverse().join("."))}l();if("behind-the-scene"===a.pageHostname)uDom("body").toggleClass("dirty",!1);else{c=[];b=a.firewallRules;for(var e in b)!1!==b.hasOwnProperty(e)&&(d=b[e],""!==d&&c.push(d));c.push(uDom("body").hasClass("off"));f=e=c.sort().join("");uDom("body").toggleClass("dirty",e!==f)}p()})};uDom.onLoad(function(){var a=null,b=window.location&&window.location.search.match(/[\?&]tabId=([^&]+)/);b&&2===b.length&&(a=b[1]);g(a);uDom(".btnManageSite").on("click",m);uDom(".btnManageIntentlyEnabled").on("click",
n);uDom("#ext-close").on("click",function(){vAPI.closePopup()});uDom(".clickable").on("click",function(a){this.hasAttribute("data-href")&&""!==this.getAttribute("data-href")&&(a.preventDefault(),k(this.getAttribute("data-href")))})})})();
